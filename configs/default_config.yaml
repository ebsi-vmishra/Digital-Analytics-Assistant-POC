run_id: "devco_run"                  # used to version output folders
output_dir: "outputs"                # base output path
tenant_id: "ReportingDevCo"
sample_rows_per_table: 500

database:
  # You can use EITHER a DSN or a raw ODBC string (raw is recommended here).
  dsn: "ReportingDevCo"
  # Raw ODBC string is URL-encoded by the pipeline helpers; leave as a raw ODBC string here:
  odbc_connection_string: "Driver={ODBC Driver 17 for SQL Server};Server=DF2V-APSQL-Q02;Database=reporting_devco;Trusted_Connection=no;UID=vannaai;PWD=empyrean1;"

llm:
  enabled: true
  model: "gpt-4.1"                   # or "gpt-4o-mini", etc.
  temperature: 0.1
  max_retries: 4
  request_timeout_sec: 60
  json_strict: true
  api_key: "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"
  table_limit: null                  # null/0 -> all tables; set to e.g. 25 for quick test runs
  verify_ssl: false
  ca_bundle_path: "C:/certs/corp-root.pem"
  base_url: ""                       # leave blank unless using a gateway
  # ---- logging & batching ----
  log_dir: "artifacts/logs"
  log_level: "INFO"                  # DEBUG | INFO | WARNING | ERROR
  log_prompts: true
  redact_values: ["api_key"]
  max_input_bytes: 180000
  docs_batch_size: 8
  concepts_batch_size: 12
  synonyms_batch_size: 200
  system_prompt: |
    You are a meticulous data analyst and metadata architect. You never invent columns or tables
    that are not present in inputs. You normalize synonyms and business terms conservatively, with
    provenance and confidence notes. Prefer short, precise definitions.

# ------- Schema filters for bundle creation (ingest/profile) -------
ingest:
  schema_include: ["reporting"]      # [] or omit => all schemas

profile:
  schema_include: ["reporting"]

limits:
  llm_tables_max: null               # e.g., 50 to only process first 50 tables for testing

docs:
  batch_size: 8

concepts:
  rules_dir: "concepts/rules"
  policies_dir: "concepts/policies"

flow:
  steps:
    # Core metadata
    ingest: false          # builds infoschema/schema.json/relationships
    profile: false         # builds profiling artifacts (profiles)
    docs: false            # runs auto_docs_llm to create docs_jsonl
    concepts: true        # runs build_concepts_llm
    synonyms: true        # runs synonyms_llm / synonyms_map (synonyms + attr_map + values)
    # Newer steps
    export_ddl: true      # runs export_ddl.py → artifacts/ddl/*.sql
    compile_concepts: true  # runs compile_concepts.py → concepts_prompt, compiled_rules
    emit_system_prompt: true # runs emit_system_prompt.py → system_prompt.txt
    export_bundle: true   # runs bundle_export → artifacts/vanna_bundle
  synonyms_mode: "llm"               # "llm" or "heuristic"

# Training-time artifact toggles: used by Vanna app / batch harness / fidelity grid
# Each key corresponds directly to one column in the grid:
#   infoschema, docs, concepts, synonyms, schema, relationships,
#   ddl, profiles, attr_map, values
train_artifacts:
  infoschema: true      # live schema / info schema training
  docs: true            # NL docs
  concepts: true        # concept catalog/aliases/attributes/rules
  synonyms: true        # synonyms.json, concept_synonyms, etc.
  schema: true          # schema.json / physical structure training
  relationships: true   # relationships.json / FK graph
  ddl: true             # DDL *.sql training
  profiles: true        # profiling CSV/JSON training
  attr_map: true        # attribute_map.json (or sanitized version)
  values: true          # value_aliases/domains artifacts

inputs:
  schema_json: "artifacts/schema.json"
  relationships_json: "artifacts/relationships.json"
  profiles_dir: "artifacts/profiles"
  profiles_summary_csv: "artifacts/profiles_summary.csv"
  heuristic_synonyms_json: "artifacts/synonyms.json"         # used if synonyms_mode=heuristic
  heuristic_attribute_map_json: "artifacts/attribute_map.json"

outputs:
  docs_jsonl: "artifacts/schema_docs.jsonl"
  ddl_dir: "artifacts/ddl"
  prompts_dir: "artifacts/prompts"
  concepts_out_dir: "artifacts/concepts"
  concepts:
    catalog_csv: "artifacts/concepts/concept_catalog.csv"
    alias_csv: "artifacts/concepts/concept_alias.csv"
    attributes_csv: "artifacts/concepts/concept_attributes.csv"
    rules_csv: "artifacts/concepts/concept_rules.csv"
  synonyms_json: "artifacts/synonyms.json"                   # produced by LLM mode
  attribute_map_json: "artifacts/attribute_map.json"         # produced by LLM mode
  vanna_bundle_dir: "artifacts/vanna_bundle"

# ---------- Vanna orchestration ----------
vanna:
  # Defaults used when CLI flags don't pass names
  sql:
    mssql_db_name: "reporting_devco"   # key under connections.mssql
    pg_store_name: "my_postgres2"      # key under connections.postgres (required for PG_VectorStore)

  # Instances aligned to the fidelity grid
  #
  # Supported methods (see app/vanna_app_poc.py):
  #   - info_schema
  #   - bundle
  #   - bundle_plus_info
  #   - bundle_select
  #   - bundle_select_plus_info
  #
  # bundle_parts (for the *select* methods) can include:
  #   "ddl", "docs", "profiles", "schema", "relationships", "concepts", "synonyms", "attr_map", "values"
  #
  # Each instance here corresponds to one row in your test grid.
  instances:
    # 1) Info schema (baseline) — Generic Vanna from live schema only
    - id: "01_info_only"
      method: "info_schema"
      mssql_db: "reporting_devco"
      schema: "reporting"
      pg_store: "my_postgres"
      port: 8110

    # 2) Info schema + full bundle (highest fidelity target)
    - id: "13_info_full_bundle"
      method: "bundle_plus_info"
      bundle_dir: "artifacts/vanna_bundle"
      mssql_db: "reporting_devco"
      schema: "reporting"
      pg_store: "my_postgres2"
      port: 8122

    # 3) Schema + Relationships + DDL only (structural snapshot only)
    - id: "14_schema_relationships_ddl"
      method: "bundle_select"
      bundle_dir: "artifacts/vanna_bundle"
      bundle_parts: ["schema", "relationships", "ddl"]
      pg_store: "my_postgres3"
      port: 8123

# ---------- Central connection strings (replaces dbAdapter.py) ----------
connections:
  mssql:
    reporting_devco: "DRIVER={ODBC Driver 17 for SQL Server};SERVER=df2v-apsql-q02,1433;DATABASE=reporting_devco;UID=vannaai;PWD=empyrean1"
    cornerstone_command: "DRIVER={ODBC Driver 17 for SQL Server};SERVER=df2v-apsql-c02,5013;DATABASE=cornerstone_command;UID=system-map;PWD=Re2Kba8vO5"
  postgres:
    my_postgres:  "postgresql://myuser:mypassword@localhost:5432/mydatabase"
    my_postgres2: "postgresql://myuser:mypassword@localhost:15432/mydatabase2"
    my_postgres3: "postgresql://myuser:mypassword@localhost:25432/mydatabase3"     # Edit Accordingly
